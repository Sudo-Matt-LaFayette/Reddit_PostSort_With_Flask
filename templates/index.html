{% extends "base.html" %}

{% block title %}Weather Station{% endblock %}

{% block content %}
<div class="app-shell">
    <section class="map-panel">
        <div class="map-image" style="background-image: {% if map_image_url %}url('{{ map_image_url }}'){% else %}radial-gradient(circle at top, #1f2937, #0f172a 60%, #020617){% endif %};"></div>
        <div class="map-overlay">
            <div class="map-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div class="station-tag">
                    <i class="fa-solid fa-satellite-dish"></i>
                    Weather Station
                </div>
                <div class="map-controls">
                    <div class="map-control"><i class="fa-solid fa-plus"></i></div>
                    <div class="map-control"><i class="fa-solid fa-minus"></i></div>
                    <div class="map-control"><i class="fa-solid fa-location-crosshairs"></i></div>
                </div>
            </div>
            <div class="map-footer">
                <div>
                    <i class="fa-solid fa-location-dot"></i>
                    {{ weather.location }}
                </div>
                <div class="status-chip">
                    {% if api_status.mapbox %}
                        Mapbox live
                    {% else %}
                        Mapbox key missing
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <aside class="info-panel">
        <div class="time-block">
            <div class="date">{{ weather.time.strftime('%A %B %d').replace(' 0', ' ') }}</div>
            <div class="time">{{ weather.time.strftime('%I:%M %p').lstrip('0') }}</div>
            <div class="sun-times">
                <span><i class="fa-solid fa-sun"></i> {{ weather.current.sunrise }}</span>
                <span><i class="fa-solid fa-moon"></i> {{ weather.current.sunset }}</span>
            </div>
        </div>

        <div class="location-line">
            <i class="fa-solid fa-map-pin"></i>
            {{ weather.location }}
        </div>

        <div class="current-card">
            <div class="current-main">
                <div class="current-condition">
                    <i class="fa-solid {{ weather.current.icon }}"></i>
                    {{ weather.current.condition }}
                </div>
                <div class="current-temp">
                    {{ weather.current.temperature }}&deg;{{ units.temp }}
                </div>
            </div>
            <div class="current-metrics">
                <div class="metrics-item">
                    Feels like: {{ weather.current.feels_like }}&deg;{{ units.temp }}
                </div>
                <div class="metrics-item">
                    Wind: {{ weather.current.wind }} {{ units.wind }}
                </div>
                <div class="metrics-item">
                    Humidity: {{ weather.current.humidity }}%
                </div>
                <div class="metrics-item">
                    Precip: {{ weather.current.precip }}%
                </div>
            </div>
        </div>

        <div class="section-title">
            <span>Daily Forecast Blocks</span>
            {% if api_status.fallback %}
                <span class="status-chip">Sample data</span>
            {% endif %}
        </div>

        <div class="daily-grid">
            {% for day in weather.daily %}
            <div class="daily-card">
                <div class="day">
                    <span>{{ day.day }}</span>
                    <span>{{ day.date }}</span>
                </div>
                <div class="current-condition" style="font-size: 0.95rem;">
                    <i class="fa-solid {{ day.icon }}"></i>
                    {{ day.condition }}
                </div>
                <div class="temps">
                    High {{ day.high }}&deg;{{ units.temp }} / Low {{ day.low }}&deg;{{ units.temp }}
                </div>
                <div class="sun-row">
                    <span><i class="fa-solid fa-sun"></i> {{ day.sunrise }}</span>
                    <span><i class="fa-solid fa-moon"></i> {{ day.sunset }}</span>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if api_status.fallback %}
        <div class="fallback-note">
            Showing sample forecast because weather API keys are missing or
            unavailable. Add MAPBOX_API_KEY and TOMORROW_API_KEY in your
            environment for live data.
        </div>
        {% endif %}
    </aside>
</div>
{% endblock %}
